#N canvas 827 239 527 327 12;
#N canvas 0 0 450 250 (subpatch) 0;
#X array \$0-looper 480000 float 2;
#X coords 0 1 480000 -1 200 140 1;
#X restore 7 38 graph;
#X msg 74 389 start;
#X msg 133 389 stop;
#X obj 40 1075 *~;
#X obj 23 451 tabwrite~ \$0-looper;
#X obj 40 1025 tabread4~ \$0-looper;
#N canvas 0 50 450 300 stutter-gate 0;
#X obj 479 261 line;
#X msg 479 209 1 5000;
#X msg 560 209 0;
#X obj 479 140 bng 25 250 50 0 empty empty empty 17 7 0 10 #000000 #ffffff #ffffff;
#X obj 479 172 t b b;
#X obj 482 319 hsl 128 17 0 1 0 0 empty empty empty -2 -8 0 10 #000000 #ffffff #ffffff 0 1;
#X obj 479 378 outlet;
#X obj 479 87 inlet;
#X text 549 86 bang triggers;
#X connect 0 0 5 0;
#X connect 1 0 0 0;
#X connect 2 0 0 0;
#X connect 3 0 4 0;
#X connect 4 0 1 0;
#X connect 4 1 2 0;
#X connect 5 0 6 0;
#X connect 7 0 3 0;
#X restore 567 102 pd stutter-gate;
#X obj 100 7 tgl 25 1 \$1-is-recording empty empty 17 7 0 10 #000000 #ffffff #ffffff 0 1;
#X text 129 2 is recording;
#X obj 221 68 vsl 17 128 0 1 0 0 empty \$1-vol empty 0 -9 0 10 #000000 #ffffff #ffffff 0 0;
#X obj 263 81 vu 20 120 empty empty -1 -8 0 10 #000000 #ffffff 1 0;
#X obj 123 1140 env~;
#X obj 123 1178 - 100;
#X obj 123 1204 s \$0-vu-meter;
#X obj 253 -33 r \$0-vu-meter;
#X obj 43 248 hsl 128 17 -1 2 0 1 empty empty empty -2 -8 0 10 #000000 #ffffff #ffffff 8467 1;
#X text 7 214 playback speed;
#X obj 193 248 hsl 128 17 0 1 0 1 empty empty empty -2 -8 0 10 #000000 #ffffff #ffffff 12700 1;
#X obj -156 215 r \$1-playback-speed;
#X obj -156 248 r \$1-playback-dur;
#X text 157 214 playback duration (%);
#X obj 100 -107 r \$1-looper-rec-start, f 31;
#X obj 139 -83 r \$1-looper-rec-stop;
#X obj 74 316 r \$1-looper-rec-start, f 31;
#X obj 133 345 r \$1-looper-rec-stop;
#X obj 567 49 r \$1-looper-rec-start, f 31;
#X obj 405 29 loadbang;
#X obj 392 142 s \$1-playback-speed;
#X obj 379 182 s \$1-playback-dur;
#X obj 392 76 bng 25 250 50 0 empty empty empty 17 7 0 10 #000000 #ffffff #ffffff;
#X obj 19 189 hsl 194 16 0 441000 0 0 empty empty empty -2 -8 0 10 #000000 #ffffff #ffffff 0 1;
#X obj -156 153 r~ \$0-playhead;
#X obj -156 179 sig2float~;
#X obj 40 982 r~ \$0-playhead;
#X text 40 939 playback;
#X obj 23 287 catch~ looper-\$1-send;
#X obj 449 1069 line;
#X msg 449 1032 1 10000;
#X floatatom 449 1095 5 0 0 0 - - - 12;
#X obj 449 1204 s \$0-recordhead;
#X msg 522 1032 0;
#X obj 283 1120 expr ($f1 == 1);
#X obj 283 1146 sel 1;
#X obj 283 1172 bng 25 250 50 0 empty empty empty 17 7 0 10 #000000 #ffffff #ffffff;
#X obj 283 1204 s \$1-looper-rec-stop;
#X obj 449 979 r \$1-looper-rec-start;
#X obj 522 1000 r \$1-looper-rec-stop;
#X text 302 933 in case we record for longer than 10 secs;
#X obj 183 533 r looper-pos;
#X obj 26 570 r looper-rec-start;
#X obj 140 670 spigot;
#X obj 374 736 s \$1-looper-rec-stop;
#X obj 140 736 s \$1-looper-rec-start;
#X obj 183 570 expr ($f1 == \$1);
#X obj 371 340 hsl 128 17 0 1 0 0 empty empty empty -2 -8 0 10 #000000 #ffffff #ffffff 0 1;
#X obj 362 379 s \$1-playback-dur;
#X obj 371 420 hsl 128 17 -1 2 0 0 empty empty empty -2 -8 0 10 #000000 #ffffff #ffffff 0 1;
#X obj 362 460 s \$1-playback-speed;
#X text 21 -386 \$1-playback-speed (-1 - 2);
#X text 21 -415 receives;
#X text 21 -333 \$1-vol (0-1);
#X text 21 -231 sends;
#X text 21 -360 \$1-playback-dur (0-1) -- % of total buffer length;
#X text 21 -196 \$1-phase (0-1) -- Phase of playback;
#X text 416 -351 outlets;
#X text 416 -322 audio out to FX;
#X text 21 -308 \$1-looper-rec-start;
#X text 21 -286 \$1-looper-rec-stop;
#X text 1215 202 when not receiving modifiers \, buffer should be continuously playing back;
#X text 1215 240 duration should also update internal playback speed to make sure speed stays proportional;
#X text 1215 288 length of recorded sample should clamp the duration (which is otherwise the entire length of the buffer) so it shhould only be a modifier to the phase;
#X obj 1215 1189 s~ \$0-playhead;
#X obj 1215 674 phasor~;
#X obj 1236 752 hsl 128 17 0 1 0 0 empty empty empty -2 -8 0 10 #000000 #ffffff #ffffff 0 1;
#X obj 1230 705 sig2float~;
#X text 1283 670 generate phase (0-1);
#X text 21 -144 buffer is 441000 samples;
#X obj 1243 793 r \$1-playback-dur;
#X obj 1345 1189 hsl 128 17 0 480000 0 0 empty empty empty -2 -8 0 10 #000000 #ffffff #ffffff 0 1;
#X obj 1339 1160 sig2float~, f 12;
#X text 1215 478 PLAYHEAD (POINTER) GENERATOR;
#X obj 1601 579 timer;
#X obj 1601 532 bng 25 250 50 0 empty empty empty 17 7 0 10 #000000 #ffffff #ffffff;
#X obj 1637 532 bng 25 250 50 0 empty empty empty 17 7 0 10 #000000 #ffffff #ffffff;
#X floatatom 1601 605 5 0 0 0 - - - 12;
#X text 1646 600 playback length (ms);
#X obj 1601 639 s \$0-playback-length;
#X obj 1238 558 r \$0-playback-length;
#X obj 1238 584 expr (1000 / $f1);
#X text 1382 581 period (ms) to freq;
#X floatatom 1215 639 5 0 0 0 - - - 12;
#X obj 1215 520 r \$1-playback-speed;
#X obj 1215 611 *;
#X text 1686 725 to transpose a semitone freq * 2^1/12 \, whole tone freq * 2^2/12 \, etc;
#X obj 1686 932 s \$1-playback-speed;
#X obj 1686 882 expr pow(2 \, ($f1 / 12));
#X floatatom 1686 908 5 0 0 0 - - - 12;
#X floatatom 1686 850 5 0 0 0 - - - 12;
#X text 1686 812 transpose by semitones;
#X text 140 498 start recording when;
#X obj 338 570 r looper-rec-stop;
#X obj 338 670 spigot;
#X obj 600 433 s looper-rec-start;
#X obj 773 433 s looper-rec-stop;
#X obj 600 353 bng 25 250 50 0 empty empty empty 17 7 0 10 #000000 #ffffff #ffffff;
#X obj 773 353 bng 25 250 50 0 empty empty empty 17 7 0 10 #000000 #ffffff #ffffff;
#X obj 1511 468 r \$1-looper-rec-start;
#X obj 1697 468 r \$1-looper-rec-stop;
#X obj 1215 861 min~;
#X floatatom 1243 819 5 0 0 0 - - - 12;
#X obj 1243 894 expr~ ($v1 == $f2);
#X obj 1243 920 sig2float~;
#X obj 1243 946 sel 1;
#X obj 1243 972 bng 25 250 50 0 empty empty empty 17 7 0 10 #000000 #ffffff #ffffff;
#X msg 1243 1027 0;
#X obj 1215 1066 *~ 480000;
#X obj 1281 1003 r \$0-playback-length;
#X obj 1281 1034 * 48;
#X obj 40 1262 s~ looper-\$1-out;
#X obj 338 766 s step-pos;
#X obj 338 696 t b b;
#X obj 567 153 s \$1-playback-dur;
#X obj 63 1047 r \$1-vol;
#X obj 392 111 i 1;
#X obj 392 3 r \$1-looper-rec-start;
#X obj 100 -60 i 1;
#X obj 139 -60 i 0;
#X obj 221 38 bng 25 250 50 0 \$1-clear empty empty 17 7 0 10 #000000 #ffffff #ffffff;
#X text 253 37 clear;
#X obj 878 161 bng 24 250 50 0 empty empty empty 17 7 0 10 #000000 #ffffff #ffffff;
#X msg 878 216 \; \$1-looper const 0;
#X obj 878 190 i \$0;
#X connect 1 0 4 0;
#X connect 2 0 4 0;
#X connect 3 0 11 0;
#X connect 3 0 118 0;
#X connect 5 0 3 0;
#X connect 6 0 121 0;
#X connect 11 0 12 0;
#X connect 12 0 13 0;
#X connect 14 0 10 0;
#X connect 18 0 15 0;
#X connect 19 0 17 0;
#X connect 21 0 125 0;
#X connect 22 0 126 0;
#X connect 23 0 1 0;
#X connect 24 0 2 0;
#X connect 26 0 29 0;
#X connect 29 0 123 0;
#X connect 31 0 32 0;
#X connect 32 0 30 0;
#X connect 33 0 5 0;
#X connect 35 0 4 0;
#X connect 36 0 38 0;
#X connect 37 0 36 0;
#X connect 38 0 39 0;
#X connect 38 0 41 0;
#X connect 40 0 36 0;
#X connect 41 0 42 0;
#X connect 42 0 43 0;
#X connect 43 0 44 0;
#X connect 45 0 37 0;
#X connect 46 0 40 0;
#X connect 48 0 53 0;
#X connect 49 0 50 0;
#X connect 50 0 52 0;
#X connect 53 0 50 1;
#X connect 53 0 101 1;
#X connect 54 0 55 0;
#X connect 56 0 57 0;
#X connect 72 0 74 0;
#X connect 72 0 108 0;
#X connect 74 0 73 0;
#X connect 77 0 109 0;
#X connect 79 0 78 0;
#X connect 81 0 84 0;
#X connect 82 0 81 0;
#X connect 83 0 81 1;
#X connect 84 0 86 0;
#X connect 87 0 88 0;
#X connect 88 0 92 1;
#X connect 90 0 72 0;
#X connect 91 0 92 0;
#X connect 92 0 90 0;
#X connect 95 0 96 0;
#X connect 96 0 94 0;
#X connect 97 0 95 0;
#X connect 100 0 101 0;
#X connect 101 0 120 0;
#X connect 104 0 102 0;
#X connect 105 0 103 0;
#X connect 106 0 82 0;
#X connect 107 0 83 0;
#X connect 108 0 110 0;
#X connect 108 0 115 0;
#X connect 109 0 108 1;
#X connect 109 0 110 1;
#X connect 110 0 111 0;
#X connect 111 0 112 0;
#X connect 112 0 113 0;
#X connect 113 0 114 0;
#X connect 114 0 72 1;
#X connect 115 0 71 0;
#X connect 115 0 79 0;
#X connect 116 0 117 0;
#X connect 117 0 115 1;
#X connect 120 0 119 0;
#X connect 120 1 51 0;
#X connect 122 0 3 1;
#X connect 123 0 27 0;
#X connect 123 0 28 0;
#X connect 124 0 29 0;
#X connect 125 0 7 0;
#X connect 126 0 7 0;
#X connect 129 0 131 0;
#X connect 131 0 130 0;
#X coords 0 0 1 1 366 274 1 0 0;
